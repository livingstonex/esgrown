{"ast":null,"code":"import _objectSpread from \"/Users/mac/Desktop/projekte/esgrown/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/Users/mac/Desktop/projekte/esgrown/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/mac/Desktop/projekte/esgrown/src/components/corp_dashboard_components/subscriptions/rm/rm-sub-form.js\";\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport PayStackButton from '../../../ind_dashboard_components/paystack/paystackpaymentbutton';\nimport toast from '../../../../util/toast';\n\nconst RMSubForm = ({\n  show,\n  onHide,\n  closeModal\n}) => {\n  const _useState = useState(),\n        _useState2 = _slicedToArray(_useState, 2),\n        user = _useState2[0],\n        setUser = _useState2[1];\n\n  const _useState3 = useState(),\n        _useState4 = _slicedToArray(_useState3, 2),\n        amount = _useState4[0],\n        setAmount = _useState4[1];\n\n  const _useState5 = useState(),\n        _useState6 = _slicedToArray(_useState5, 2),\n        plan = _useState6[0],\n        setPlan = _useState6[1];\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        payModal = _useState8[0],\n        setPayModal = _useState8[1];\n\n  const _useState9 = useState(false),\n        _useState10 = _slicedToArray(_useState9, 2),\n        spinner = _useState10[0],\n        setSpinner = _useState10[1];\n\n  const _useState11 = useState({\n    companyName: '',\n    email: '',\n    doi: ''\n  }),\n        _useState12 = _slicedToArray(_useState11, 2),\n        state = _useState12[0],\n        setState = _useState12[1];\n\n  useEffect(() => {\n    const userr = JSON.parse(sessionStorage.getItem('key'));\n    setUser(userr);\n  }, []);\n\n  const handleChange = e => {\n    const name = e.target.name;\n    const value = e.target.value;\n    setState(_objectSpread({}, state, {\n      [name]: value\n    }));\n  };\n\n  const onChangePlan = e => {\n    const plan = e.target.value.split('/');\n    setAmount(plan[1]);\n    setPlan(plan[0]);\n  };\n\n  const subscribe = () => {\n    const subData = {\n      company_id: user.id,\n      company_name: user.name,\n      email: user.email\n    }; // console.log(subData);\n\n    axios.post(`http://localhost:5000/corporatesubscriptions/add`, subData).then(res => {\n      if (res.data) {\n        closeModal();\n        setPayModal(true);\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }; //payment functions\n\n\n  const close = () => {\n    console.log(\"Payment closed\");\n    setPayModal(false);\n  };\n\n  const onSuccess = async response => {\n    setPayModal(false);\n    axios.get(`https://api.paystack.co/subscription`, {\n      headers: {\n        \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\"\n      }\n    }).then(res => {\n      // console.log(res.data)\n      const client = res.data.data.filter(st => {\n        return st.customer.email === user.email;\n      });\n      const data = {\n        sub_status_rm: client[0].status,\n        sub_code_rm: client[0].subscription_code,\n        ref: response.reference\n      };\n      axios.post(`http://localhost:5000/corporatesubscriptions/update/ref/${user.id}`, data).then(res => {\n        let lS = JSON.parse(sessionStorage.getItem('key'));\n        lS.sub_status_rm = client[0].status;\n        sessionStorage.setItem('key', JSON.stringify(lS));\n        toast(res.data, 'success');\n        closeModal('active');\n      }).catch(err => console.log(err));\n      axios.post(`http://localhost:5000/corporates/update/status/${user.id}`, data).then(res => console.log(res.data)).catch(err => console.log(err));\n    }).catch(err => console.log(err));\n  };\n\n  return React.createElement(React.Fragment, null, React.createElement(Modal, {\n    show: show,\n    onHide: onHide,\n    centered: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(Modal.Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    style: {\n      fontSize: '18px'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"Corporate Subscription\")), React.createElement(Modal.Body, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    style: {\n      fontWeight: 'bold'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, \" Company Name\"), React.createElement(\"input\", {\n    type: \"text\",\n    name: \"companyName\",\n    value: user ? user.name : \"\",\n    onChange: handleChange,\n    placeholder: \"Company Name\",\n    className: \"form-control\",\n    required: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    style: {\n      fontWeight: 'bold'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, \" Official Email\"), React.createElement(\"input\", {\n    type: \"email\",\n    name: \"email\",\n    value: user ? user.email : \"\",\n    onChange: handleChange,\n    placeholder: \"Official Email\",\n    className: \"form-control\",\n    required: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    style: {\n      fontWeight: 'bold'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, \" Plan\"), React.createElement(\"select\", {\n    name: \"plan\",\n    className: \"form-control\",\n    onChange: onChangePlan,\n    required: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, React.createElement(\"option\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"Select a Plan\"), React.createElement(\"option\", {\n    value: \"PLN_hwug5s75tf2rcqu/280000\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, \"3 Months Plan 2800\"), React.createElement(\"option\", {\n    value: \"PLN_072a7glz3tv6fzi/455000\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, \"6 Months Plan 4550\"), React.createElement(\"option\", {\n    value: \"PLN_wma6tld3z1g2zef/797000\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, \"1 Year Plan   7970\"))))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\",\n    disabled: spinner,\n    onClick: subscribe,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, spinner ? React.createElement(Spinner, {\n    as: \"span\",\n    animation: \"grow\",\n    size: \"sm\",\n    role: \"status\",\n    \"aria-hidden\": \"true\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }) : \"Proceed\"))))), React.createElement(PayStackButton, {\n    show: payModal,\n    onHide: () => setPayModal(false),\n    close: close,\n    callback: onSuccess,\n    email: user ? user.email : \"\",\n    amount: amount,\n    plan: plan,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }));\n};\n\nexport default RMSubForm;","map":{"version":3,"sources":["/Users/mac/Desktop/projekte/esgrown/src/components/corp_dashboard_components/subscriptions/rm/rm-sub-form.js"],"names":["React","useState","useEffect","axios","Modal","Spinner","PayStackButton","toast","RMSubForm","show","onHide","closeModal","user","setUser","amount","setAmount","plan","setPlan","payModal","setPayModal","spinner","setSpinner","companyName","email","doi","state","setState","userr","JSON","parse","sessionStorage","getItem","handleChange","e","name","target","value","onChangePlan","split","subscribe","subData","company_id","id","company_name","post","then","res","data","catch","err","console","log","close","onSuccess","response","get","headers","client","filter","st","customer","sub_status_rm","status","sub_code_rm","subscription_code","ref","reference","lS","setItem","stringify","fontSize","fontWeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport PayStackButton from '../../../ind_dashboard_components/paystack/paystackpaymentbutton';\nimport toast from '../../../../util/toast';\n\n\n\n\n\nconst RMSubForm = ({ show, onHide, closeModal }) => {\n\n    const [user, setUser] = useState();\n    const [amount, setAmount] = useState();\n    const [plan, setPlan] = useState();\n    const [payModal, setPayModal] = useState(false);\n    const [spinner, setSpinner] = useState(false)\n\n    const [state, setState] = useState({\n        companyName: '',\n        email: '',\n        doi: ''\n    });\n\n    useEffect(() => {\n        const userr = JSON.parse(sessionStorage.getItem('key'));\n        setUser(userr)\n    }, []);\n\n    const handleChange = (e) => {\n        const name = e.target.name;\n        const value = e.target.value;\n\n        setState({\n            ...state,\n            [name]: value\n        })\n    }\n\n    const onChangePlan = (e) => {\n        const plan = e.target.value.split('/');\n        setAmount(plan[1]);\n        setPlan(plan[0]);\n    }\n\n    const subscribe = () => {\n\n        const subData = {\n            company_id: user.id,\n            company_name: user.name,\n            email: user.email\n        }\n\n        // console.log(subData);\n        axios.post(`http://localhost:5000/corporatesubscriptions/add`, subData)\n            .then(res => {\n                if (res.data) {\n                    closeModal();\n                    setPayModal(true);\n                }\n            }).catch(err => {\n                console.log(err)\n            })\n\n    }\n\n\n    //payment functions\n    const close = () => {\n        console.log(\"Payment closed\");\n        setPayModal(false)\n    }\n\n    const onSuccess = async (response) => {\n        setPayModal(false);\n        \n\n\n\n        axios.get(`https://api.paystack.co/subscription`, { headers: { \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\" } })\n            .then(res => {\n                // console.log(res.data)\n                const client = res.data.data.filter(st => {\n                    return st.customer.email === user.email\n                })\n\n\n                const data = {\n                    sub_status_rm: client[0].status,\n                    sub_code_rm: client[0].subscription_code,\n                    ref: response.reference\n                }\n\n                axios.post(`http://localhost:5000/corporatesubscriptions/update/ref/${user.id}`, data)\n                    .then(res => {\n                        let lS = JSON.parse(sessionStorage.getItem('key'));\n                        lS.sub_status_rm = client[0].status;\n\n                        sessionStorage.setItem('key', JSON.stringify(lS));\n                        toast(res.data, 'success')\n                        closeModal('active');\n                    })\n                    .catch(err => console.log(err));\n\n                axios.post(`http://localhost:5000/corporates/update/status/${user.id}`, data)\n                    .then(res => console.log(res.data)).catch(err => console.log(err))\n\n            })\n            .catch(err => console.log(err));\n\n    }\n\n\n\n    return (\n        <>\n            <Modal show={show} onHide={onHide} centered>\n                <Modal.Header>\n                    <span style={{ fontSize: '18px' }}>Corporate Subscription</span>\n                </Modal.Header>\n                <Modal.Body>\n                    <div className=\"container\">\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}> Company Name</label>\n                                <input type=\"text\" name=\"companyName\" value={user ? user.name : \"\"} onChange={handleChange} placeholder=\"Company Name\" className=\"form-control\" required />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}> Official Email</label>\n                                <input type=\"email\" name=\"email\" value={user ? user.email : \"\"} onChange={handleChange} placeholder=\"Official Email\" className=\"form-control\" required />\n                            </div>\n                        </div>\n\n                        {/* <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}>Date of Incorporation</label>\n                                <input type=\"date\" name=\"doi\" value={user ? user.doi:\"\"} onChange={handleChange} placeholder=\"Date of Incorporation\" className=\"form-control\" required />\n                            </div>\n                        </div> */}\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}> Plan</label>\n                                <select name=\"plan\" className=\"form-control\" onChange={onChangePlan} required>\n                                    <option >Select a Plan</option>\n                                    <option value=\"PLN_hwug5s75tf2rcqu/280000\">3 Months Plan 2800</option>\n                                    <option value=\"PLN_072a7glz3tv6fzi/455000\">6 Months Plan 4550</option>\n                                    <option value=\"PLN_wma6tld3z1g2zef/797000\">1 Year Plan   7970</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"row mt-3\">\n                        <div className=\"col\">\n                            <button\n                                className=\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"\n                                disabled={spinner}\n                                onClick={subscribe}\n                            >\n                                {spinner ? <Spinner as=\"span\" animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\" /> : \"Proceed\"}\n                            </button>\n                        </div>\n                    </div>\n\n                </Modal.Body>\n\n            </Modal>\n            <PayStackButton\n                show={payModal}\n                onHide={() => setPayModal(false)}\n                close={close}\n                callback={onSuccess}\n                email={user ? user.email : \"\"}\n                amount={amount}\n                plan={plan}\n            />\n        </>\n    );\n}\nexport default RMSubForm;"]},"metadata":{},"sourceType":"module"}