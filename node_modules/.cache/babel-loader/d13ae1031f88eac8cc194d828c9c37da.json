{"ast":null,"code":"import _slicedToArray from \"/Users/mac/Desktop/projekte/esgrown/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/mac/Desktop/projekte/esgrown/src/components/ind_dashboard_components/subscription-forms/eas-form.js\";\nimport React, { useState, useEffect, Fragment } from 'react';\nimport PayStackButton from '../paystack/paystackpaymentbutton';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport axios from 'axios';\nimport toast from '../../../util/toast';\nexport default function Form(props) {\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        modalShow = _useState2[0],\n        setModalShow = _useState2[1];\n\n  const _useState3 = useState(false),\n        _useState4 = _slicedToArray(_useState3, 2),\n        modalPayShow = _useState4[0],\n        setModalPayShow = _useState4[1];\n\n  const _useState5 = useState(\"\"),\n        _useState6 = _slicedToArray(_useState5, 2),\n        LOE = _useState6[0],\n        setLOE = _useState6[1];\n\n  const _useState7 = useState(\"\"),\n        _useState8 = _slicedToArray(_useState7, 2),\n        FIS = _useState8[0],\n        setFIS = _useState8[1];\n\n  const _useState9 = useState(\"\"),\n        _useState10 = _slicedToArray(_useState9, 2),\n        TIC = _useState10[0],\n        setTIC = _useState10[1];\n\n  const _useState11 = useState(true),\n        _useState12 = _slicedToArray(_useState11, 2),\n        ticDisable = _useState12[0],\n        setTicDisable = _useState12[1];\n\n  const _useState13 = useState(\"\"),\n        _useState14 = _slicedToArray(_useState13, 2),\n        useremail = _useState14[0],\n        setUserEmail = _useState14[1];\n\n  const _useState15 = useState(\"\"),\n        _useState16 = _slicedToArray(_useState15, 2),\n        userId = _useState16[0],\n        setUserId = _useState16[1];\n\n  const _useState17 = useState(false),\n        _useState18 = _slicedToArray(_useState17, 2),\n        subStatus = _useState18[0],\n        setSubStatus = _useState18[1];\n\n  const _useState19 = useState(\"\"),\n        _useState20 = _slicedToArray(_useState19, 2),\n        subPlan = _useState20[0],\n        setSubPlan = _useState20[1];\n\n  const _useState21 = useState(\"\"),\n        _useState22 = _slicedToArray(_useState21, 2),\n        amount = _useState22[0],\n        setAmount = _useState22[1];\n\n  const _useState23 = useState(2),\n        _useState24 = _slicedToArray(_useState23, 2),\n        button = _useState24[0],\n        setButton = _useState24[1]; //SPINNER STATE\n\n\n  const _useState25 = useState(false),\n        _useState26 = _slicedToArray(_useState25, 2),\n        spinner = _useState26[0],\n        setSpinner = _useState26[1]; //GET LOGGEDIN USER CREDENTIALS FOR PMT\n\n\n  useEffect(() => {\n    const userData = JSON.parse(sessionStorage.getItem('key'));\n    const userEmail = userData.email;\n    const userId = userData.id;\n    setUserEmail(userEmail);\n    setUserId(userId);\n\n    if (userData.sub_status_eas === 'active') {\n      setSubStatus(userData.sub_status_eas);\n      setButton(1);\n    } else {\n      setButton(2);\n    }\n  }, []);\n\n  const onChangeLOE = e => {\n    setLOE(e.target.value);\n  };\n\n  const onChangeFIS = e => {\n    setFIS(e.target.value);\n  };\n\n  const onRefferalChange = e => {\n    if (e.target.value == \"yes\") {\n      setTicDisable(false);\n    } else if (e.target.value == \"no\") {\n      setTicDisable(true);\n    }\n  };\n\n  const onChangeTIC = e => {\n    setTIC(e.target.value);\n  };\n\n  const onChangePlan = e => {\n    const plan = e.target.value.split('/');\n    setAmount(plan[1]);\n    setSubPlan(plan[0]);\n  };\n\n  const onSubmit = e => {\n    e.preventDefault();\n    const SubObject = {\n      user_id: props.user.id,\n      sub_status: \"inactive\",\n      user_email: props.user.email,\n      user_name: props.user.name,\n      user_status: props.user.status,\n      levelofeducation: LOE,\n      field_of_intended_study: FIS,\n      tic: TIC\n    };\n\n    try {\n      setSpinner(true);\n      axios.post('http://localhost:5000/subscriptioneas/add', SubObject).then(res => {\n        setSpinner(false);\n        setModalShow(false);\n        setModalPayShow(true);\n      }).catch(err => {\n        console.log('Err: ' + err);\n        setSpinner(false);\n        setModalShow(false);\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }; //Paystack Functions\n\n\n  const onSuccess = res => {\n    console.log(res);\n    setModalPayShow(false); //make a call to https://api.paystack.co/subscription and get all subscription \n    //and filter for email of current subscription and extract subscription code.\n    //update individual doc with the gotten data.\n\n    axios.get(`https://api.paystack.co/subscription`, {\n      headers: {\n        \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\"\n      }\n    }).then(res => {\n      const client = res.data.data.filter(st => {\n        return st.customer.email === useremail;\n      });\n      const data = {\n        ref: res.reference,\n        sub_status: client[0].status,\n        sub_code: client[0].subscription_code\n      }; //update eas substatus\n\n      axios.post(`http://localhost:5000/subscriptioneas/update/easref/${userId}`, data).then(res => console.log(res.data)).catch(err => console.log(err)); //update user details\n\n      axios.post(`http://localhost:5000/individuals/update/substatus/${userId}`, {\n        sub_status_eas: client[0].status\n      }).then(res => {\n        const globalUser = JSON.parse(sessionStorage.getItem('key'));\n        globalUser.sub_status_eas = client[0].status;\n        sessionStorage.setItem('key', JSON.stringify(globalUser));\n        setButton(1);\n      }).catch(err => console.log(err));\n    }).catch(err => console.log(err));\n  };\n\n  const close = () => {\n    console.log(\"Payment closed\");\n    setModalPayShow(false);\n  };\n\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"ml-auto d-flex align-items-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, button === 1 ? React.createElement(\"button\", {\n    className: \"btn btn-info btn-sm\",\n    disabled: true,\n    style: {\n      color: 'white',\n      background: '#97ba0d',\n      border: '#97ba0d'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Subscribed\") : button === 2 ? React.createElement(\"button\", {\n    className: \"btn btn-info btn-sm\",\n    onClick: () => setModalShow(true),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Subscribe\") : React.createElement(\"button\", {\n    className: \"btn btn-info btn-sm\",\n    onClick: () => setModalShow(true),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Subscribe\"))), React.createElement(Modal, {\n    show: modalShow,\n    onHide: () => setModalShow(false),\n    \"aria-labelledby\": \"example-custom-modal-styling-title\",\n    centered: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, React.createElement(Modal.Body, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }, React.createElement(\"form\", {\n    className: \"container py-4\",\n    onSubmit: onSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, React.createElement(\"h6\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"Subscription Details\"))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }, React.createElement(\"select\", {\n    className: \"form-control\",\n    required: true,\n    onChange: onChangeLOE,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, React.createElement(\"option\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, \"Level of Education\"), React.createElement(\"option\", {\n    value: \"degree\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, \"Degree\"), React.createElement(\"option\", {\n    value: \"masters\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"Masters\"), React.createElement(\"option\", {\n    value: \"phd\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, \"Ph.D\")))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    label: \"\",\n    type: \"text\",\n    value: FIS,\n    onChange: onChangeFIS,\n    placeholder: \"Field of Intended Study\",\n    required: true,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  }, React.createElement(\"select\", {\n    className: \"form-control\",\n    required: true,\n    onChange: onChangePlan,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }, React.createElement(\"option\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }, \"Select Subscription Plan\"), React.createElement(\"option\", {\n    value: \"PLN_euav5svesnpj2ct/515000\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, \"Annual(One Year)\")))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223\n    },\n    __self: this\n  }, React.createElement(\"select\", {\n    className: \"form-control\",\n    onChange: onRefferalChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, React.createElement(\"option\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  }, \"Where you refered by a Teacher?\"), React.createElement(\"option\", {\n    value: \"yes\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226\n    },\n    __self: this\n  }, \"Yes\"), React.createElement(\"option\", {\n    value: \"no\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  }, \"No\")))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    label: \"\",\n    type: \"text\",\n    disabled: ticDisable,\n    value: TIC,\n    onChange: onChangeTIC,\n    placeholder: ticDisable ? \"No Worries, TIC is Optional\" : \"Please enter Teacher's Identification Code\",\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"row mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\",\n    disabled: spinner,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251\n    },\n    __self: this\n  }, \"Proceed \", spinner ? React.createElement(Spinner, {\n    as: \"span\",\n    animation: \"grow\",\n    size: \"sm\",\n    role: \"status\",\n    \"aria-hidden\": \"true\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257\n    },\n    __self: this\n  }) : \"\")))))), React.createElement(PayStackButton, {\n    show: modalPayShow,\n    onHide: () => setModalPayShow(false),\n    close: close,\n    callback: onSuccess,\n    email: useremail,\n    amount: amount,\n    plan: subPlan,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265\n    },\n    __self: this\n  }));\n}","map":{"version":3,"sources":["/Users/mac/Desktop/projekte/esgrown/src/components/ind_dashboard_components/subscription-forms/eas-form.js"],"names":["React","useState","useEffect","Fragment","PayStackButton","Modal","Spinner","axios","toast","Form","props","modalShow","setModalShow","modalPayShow","setModalPayShow","LOE","setLOE","FIS","setFIS","TIC","setTIC","ticDisable","setTicDisable","useremail","setUserEmail","userId","setUserId","subStatus","setSubStatus","subPlan","setSubPlan","amount","setAmount","button","setButton","spinner","setSpinner","userData","JSON","parse","sessionStorage","getItem","userEmail","email","id","sub_status_eas","onChangeLOE","e","target","value","onChangeFIS","onRefferalChange","onChangeTIC","onChangePlan","plan","split","onSubmit","preventDefault","SubObject","user_id","user","sub_status","user_email","user_name","name","user_status","status","levelofeducation","field_of_intended_study","tic","post","then","res","catch","err","console","log","error","onSuccess","get","headers","client","data","filter","st","customer","ref","reference","sub_code","subscription_code","globalUser","setItem","stringify","close","color","background","border"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Fragment } from 'react';\nimport PayStackButton from '../paystack/paystackpaymentbutton';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport axios from 'axios';\nimport toast from '../../../util/toast';\n\n\n\n\nexport default function Form(props) {\n\n    const [modalShow, setModalShow] = useState(false);\n    const [modalPayShow, setModalPayShow] = useState(false);\n    const [LOE, setLOE] = useState(\"\");\n    const [FIS, setFIS] = useState(\"\");\n    const [TIC, setTIC] = useState(\"\");\n    const [ticDisable, setTicDisable] = useState(true);\n    const [useremail, setUserEmail] = useState(\"\");\n    const [userId, setUserId] = useState(\"\");\n    const [subStatus, setSubStatus] = useState(false);\n\n\n    const [subPlan, setSubPlan] = useState(\"\");\n    const [amount, setAmount] = useState(\"\");\n    const [button, setButton] = useState(2)\n\n    //SPINNER STATE\n    const [spinner, setSpinner] = useState(false);\n\n    //GET LOGGEDIN USER CREDENTIALS FOR PMT\n    useEffect(() => {\n        const userData = JSON.parse(sessionStorage.getItem('key'));\n        const userEmail = userData.email;\n        const userId = userData.id;\n        setUserEmail(userEmail);\n        setUserId(userId);\n\n\n        if (userData.sub_status_eas === 'active') {\n\n            setSubStatus(userData.sub_status_eas);\n            setButton(1);\n\n        }else{\n            setButton(2);\n        }\n\n    }, [])\n\n\n    const onChangeLOE = (e) => {\n        setLOE(e.target.value);\n\n    }\n\n    const onChangeFIS = (e) => {\n        setFIS(e.target.value);\n    }\n\n    const onRefferalChange = (e) => {\n        if (e.target.value == \"yes\") {\n            setTicDisable(false);\n        } else if (e.target.value == \"no\") {\n            setTicDisable(true);\n        }\n\n    }\n\n    const onChangeTIC = (e) => {\n        setTIC(e.target.value);\n    }\n\n    const onChangePlan = (e) => {\n        const plan = e.target.value.split('/');\n        setAmount(plan[1]);\n        setSubPlan(plan[0]);\n    }\n\n\n    const onSubmit = (e) => {\n        e.preventDefault();\n\n        const SubObject = {\n            user_id: props.user.id,\n            sub_status: \"inactive\",\n            user_email: props.user.email,\n            user_name: props.user.name,\n            user_status: props.user.status,\n            levelofeducation: LOE,\n            field_of_intended_study: FIS,\n            tic: TIC\n        }\n        try {\n            setSpinner(true);\n            axios.post('http://localhost:5000/subscriptioneas/add', SubObject)\n                .then((res) => {\n                    setSpinner(false);\n                    setModalShow(false);\n                    setModalPayShow(true);\n                })\n                .catch((err) => {\n                    console.log('Err: ' + err);\n                    setSpinner(false);\n                    setModalShow(false);\n                });\n\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n\n    //Paystack Functions\n    const onSuccess = (res) => {\n        console.log(res);\n        setModalPayShow(false);\n\n        //make a call to https://api.paystack.co/subscription and get all subscription \n        //and filter for email of current subscription and extract subscription code.\n        //update individual doc with the gotten data.\n\n        axios.get(`https://api.paystack.co/subscription`, { headers: { \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\" } })\n            .then(res => {\n                const client = res.data.data.filter(st => {\n                    return st.customer.email === useremail\n                })\n\n                const data = {\n                    ref: res.reference,\n                    sub_status: client[0].status,\n                    sub_code: client[0].subscription_code\n                }\n\n                //update eas substatus\n                axios.post(`http://localhost:5000/subscriptioneas/update/easref/${userId}`, data)\n                    .then(res => console.log(res.data))\n                    .catch(err => console.log(err))\n\n\n                //update user details\n                axios.post(`http://localhost:5000/individuals/update/substatus/${userId}`, { sub_status_eas: client[0].status})\n                    .then(res => {\n                        const globalUser = JSON.parse(sessionStorage.getItem('key'));\n\n                        globalUser.sub_status_eas = client[0].status;\n\n                        sessionStorage.setItem('key', JSON.stringify(globalUser));\n                        setButton(1)\n\n                    }).catch(err => console.log(err))\n\n            }).catch(err => console.log(err));\n\n\n    }\n\n    const close = () => {\n        console.log(\"Payment closed\");\n        setModalPayShow(false)\n    }\n\n\n    return (\n        <React.Fragment>\n            <div className=\"ml-auto d-flex align-items-center\">\n                <React.Fragment>\n                    {(button === 1) ? <button className=\"btn btn-info btn-sm\" disabled style={{ color: 'white', background: '#97ba0d', border: '#97ba0d' }}>Subscribed</button> : (button === 2) ? <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button> : <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button>}\n                </React.Fragment>\n\n            </div>\n            <Modal\n                show={modalShow}\n                onHide={() => setModalShow(false)}\n                aria-labelledby=\"example-custom-modal-styling-title\"\n                centered\n            >\n                <Modal.Body>\n\n                    <form className=\"container py-4\" onSubmit={onSubmit}>\n                        <div className=\"row\">\n                            <div className=\"col\">\n                                <h6>Subscription Details</h6>\n                            </div>\n                        </div>\n                        {/* Level of Education */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangeLOE}>\n                                    <option>Level of Education</option>\n                                    <option value=\"degree\">Degree</option>\n                                    <option value=\"masters\">Masters</option>\n                                    <option value=\"phd\">Ph.D</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Intended Study field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    value={FIS}\n                                    onChange={onChangeFIS}\n                                    placeholder=\"Field of Intended Study\"\n                                    required\n                                    className=\"form-control\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangePlan}>\n                                    <option>Select Subscription Plan</option>\n                                    <option value=\"PLN_euav5svesnpj2ct/515000\">Annual(One Year)</option>\n                                </select>\n                            </div>\n                        </div>\n\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" onChange={onRefferalChange}>\n                                    <option>Where you refered by a Teacher?</option>\n                                    <option value=\"yes\">Yes</option>\n                                    <option value=\"no\">No</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Tic field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    disabled={ticDisable}\n                                    value={TIC}\n                                    onChange={onChangeTIC}\n                                    placeholder={ticDisable ? \"No Worries, TIC is Optional\" : \"Please enter Teacher's Identification Code\"}\n                                    className=\"form-control\"\n\n                                />\n                            </div>\n                        </div>\n\n                        {/* submit button */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <button\n                                    type=\"submit\"\n                                    className=\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"\n                                    disabled={spinner}\n                                >\n                                    Proceed {spinner ?\n                                        <Spinner as=\"span\" animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\" /> : \"\"}\n                                </button>\n                            </div>\n                        </div>\n                    </form>\n\n                </Modal.Body>\n            </Modal>\n            <PayStackButton\n                show={modalPayShow}\n                onHide={() => setModalPayShow(false)}\n                close={close}\n                callback={onSuccess}\n                email={useremail}\n                amount={amount}\n                plan={subPlan}\n            />\n        </React.Fragment>\n    );\n}"]},"metadata":{},"sourceType":"module"}