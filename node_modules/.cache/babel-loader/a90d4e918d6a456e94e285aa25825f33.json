{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Desktop/esgrown/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import{Modal,Spinner}from'react-bootstrap';import PayStackButton from'../../../ind_dashboard_components/paystack/paystackpaymentbutton';import StaffModal from'../components/all-staff';import toast from'../../../../util/toast';var LMSubForm=function LMSubForm(_ref){var show=_ref.show,onHide=_ref.onHide,closeModal=_ref.closeModal;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),amount=_useState4[0],setAmount=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),plan=_useState6[0],setPlan=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),payModal=_useState8[0],setPayModal=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),spinner=_useState10[0],setSpinner=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),staff=_useState12[0],setStaff=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),staffModal=_useState14[0],setStaffModal=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),total=_useState16[0],setTotal=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),subPeriod=_useState18[0],setSubPeriod=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),Btn=_useState20[0],setBtn=_useState20[1];// const [state, setState] = useState({\n//     companyName: '',\n//     email: '',\n//     doi: ''\n// });\nuseEffect(function(){var userr=JSON.parse(sessionStorage.getItem('key'));setUser(userr);axios.get(\"http://localhost:5000/individuals/staff/\".concat(userr.id)).then(function(res){var unsubscribedStaff=res.data.filter(function(staff){return staff.sub_status_compt_mgt==='inactive'||staff.sub_status_compt_mgt==='completed';});setStaff(unsubscribedStaff);}).catch(function(err){return console.log(err);});},[]);var onChangePlan=function onChangePlan(e){var plan=e.target.value.split('/');setAmount(plan[1]);setPlan(plan[0]);if(Boolean(e.target.value)){setBtn(false);}else{setBtn(true);}};var showStaff=function showStaff(){setStaffModal(true);closeModal();};//get total amount * number of staff and sub\nvar closeStaffModal=function closeStaffModal(plantotal){setStaffModal(false);setTotal(plantotal);setPayModal(true);};//payment functions\nvar close=function close(){console.log(\"Payment closed\");setPayModal(false);};var onSuccess=function onSuccess(res){setPayModal(false);var data={sub_status_compt_mgt:'active'};console.log(staff);//update substatus of paid staff\nstaff.map(function(st){axios.post(\"http://localhost:5000/individuals/update/substatus/\".concat(st._id),data).then(function(res){return console.log(res.data);}).catch(function(err){return console.log(err);});axios.post(\"http://localhost:5000/competence/management/add\",{user_id:st._id,company_id:user.id,org_type:user.org_type,sub_status:'active',user_name:st.fullname,user_email:st.email,start_date:Date.now(),end_date:86400*plan+Date.now()}).then(function(res){return console.log(res.data);}).catch(function(err){return console.log(err);});});toast(\"\".concat(staff.length,\"  subscriptions successful\"),'success');};return React.createElement(React.Fragment,null,React.createElement(Modal,{show:show,onHide:onHide,centered:true},React.createElement(Modal.Header,null,React.createElement(\"span\",{style:{fontSize:'18px'}},\"Corporate Subscription\")),React.createElement(Modal.Body,null,React.createElement(\"div\",{className:\"container\"},React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"label\",{style:{fontWeight:'bold'}},\"Select A Plan\"),React.createElement(\"select\",{name:\"plan\",className:\"form-control\",onChange:onChangePlan,required:true},React.createElement(\"option\",{value:\"\"},\"Select a Plan\"),React.createElement(\"option\",{value:\"90/280000\"},\"3 Months Plan - 2800\"),React.createElement(\"option\",{value:\"180/455000\"},\"6 Months Plan - 4550\"),React.createElement(\"option\",{value:\"365/797000\"},\"1 Year Plan  - 7970 \"))))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"button\",{type:\"submit\",className:\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\",disabled:Btn,onClick:showStaff},spinner?React.createElement(Spinner,{as:\"span\",animation:\"grow\",size:\"sm\",role:\"status\",\"aria-hidden\":\"true\"}):\"Proceed\"))))),React.createElement(PayStackButton,{show:payModal,onHide:function onHide(){return setPayModal(false);},close:close,callback:onSuccess,email:user?user.email:\"\",amount:total}),React.createElement(StaffModal,{show:staffModal,onHide:function onHide(){return setStaffModal(!staffModal);},amount:amount,closeStaffModal:closeStaffModal}));};export default LMSubForm;","map":{"version":3,"sources":["/Users/mac/Desktop/esgrown/src/components/corp_dashboard_components/subscriptions/compt_mgt/lm-sub-form.js"],"names":["React","useState","useEffect","axios","Modal","Spinner","PayStackButton","StaffModal","toast","LMSubForm","show","onHide","closeModal","user","setUser","amount","setAmount","plan","setPlan","payModal","setPayModal","spinner","setSpinner","staff","setStaff","staffModal","setStaffModal","total","setTotal","subPeriod","setSubPeriod","Btn","setBtn","userr","JSON","parse","sessionStorage","getItem","get","id","then","res","unsubscribedStaff","data","filter","sub_status_compt_mgt","catch","err","console","log","onChangePlan","e","target","value","split","Boolean","showStaff","closeStaffModal","plantotal","close","onSuccess","map","st","post","_id","user_id","company_id","org_type","sub_status","user_name","fullname","user_email","email","start_date","Date","now","end_date","length","fontSize","fontWeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport PayStackButton from '../../../ind_dashboard_components/paystack/paystackpaymentbutton';\nimport StaffModal from '../components/all-staff';\nimport toast from '../../../../util/toast';\n\n\n\n\n\nconst LMSubForm = ({ show, onHide, closeModal }) => {\n\n    const [user, setUser] = useState();\n    const [amount, setAmount] = useState();\n    const [plan, setPlan] = useState();\n    const [payModal, setPayModal] = useState(false);\n    const [spinner, setSpinner] = useState(false)\n    const [staff, setStaff] = useState([]);\n    const [staffModal, setStaffModal] = useState(false)\n    const [total, setTotal] = useState();\n    const [subPeriod, setSubPeriod] = useState();\n    const [Btn, setBtn] = useState(true);\n\n\n    // const [state, setState] = useState({\n    //     companyName: '',\n    //     email: '',\n    //     doi: ''\n    // });\n\n    useEffect(() => {\n        const userr = JSON.parse(sessionStorage.getItem('key'));\n        setUser(userr)\n\n\n        axios.get(`http://localhost:5000/individuals/staff/${userr.id}`)\n            .then(res => {\n                const unsubscribedStaff = res.data.filter(staff => {\n                    return staff.sub_status_compt_mgt === 'inactive' || staff.sub_status_compt_mgt === 'completed';\n                })\n                setStaff(unsubscribedStaff);\n            }).catch(err => console.log(err));\n\n    }, []);\n\n\n    const onChangePlan = (e) => {\n        const plan = e.target.value.split('/');\n        setAmount(plan[1]);\n        setPlan(plan[0]);\n        if (Boolean(e.target.value)) {\n            setBtn(false)\n        } else {\n            setBtn(true)\n\n        }\n\n\n    }\n\n    const showStaff = () => {\n        setStaffModal(true);\n        closeModal();\n    }\n\n    //get total amount * number of staff and sub\n    const closeStaffModal = (plantotal) => {\n        setStaffModal(false);\n        setTotal(plantotal);\n        setPayModal(true);\n\n    }\n\n\n    //payment functions\n    const close = () => {\n        console.log(\"Payment closed\");\n        setPayModal(false)\n    }\n\n    const onSuccess = (res) => {\n        setPayModal(false);\n\n\n\n        const data = {\n            sub_status_compt_mgt: 'active',\n        }\n\n        console.log(staff)\n\n        //update substatus of paid staff\n        staff.map(st => {\n            axios.post(`http://localhost:5000/individuals/update/substatus/${st._id}`, data)\n                .then(res => console.log(res.data))\n                .catch(err => console.log(err));\n\n            axios.post(`http://localhost:5000/competence/management/add`, {\n                user_id: st._id,\n                company_id: user.id,\n                org_type: user.org_type,\n                sub_status: 'active',\n                user_name: st.fullname,\n                user_email: st.email,\n                start_date: Date.now(),\n                end_date: (86400 * plan) + Date.now()\n\n            }).then(res => console.log(res.data))\n                .catch(err => console.log(err))\n        })\n\n        toast(`${staff.length}  subscriptions successful`, 'success');\n    }\n\n\n\n\n    return (\n        <>\n            <Modal show={show} onHide={onHide} centered>\n                <Modal.Header>\n                    <span style={{ fontSize: '18px' }}>Corporate Subscription</span>\n                </Modal.Header>\n                <Modal.Body>\n                    <div className=\"container\">\n                        {/* <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}> Company Name</label>\n                                <input type=\"text\" name=\"companyName\" value={state.companyName} onChange={handleChange} placeholder=\"Company Name\" className=\"form-control\" required />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}> Official Email</label>\n                                <input type=\"email\" name=\"email\" value={state.email} onChange={handleChange} placeholder=\"Official Email\" className=\"form-control\" required />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}>Date of Incorporation</label>\n                                <input type=\"date\" name=\"doi\" value={state.doi} onChange={handleChange} placeholder=\"Date of Incorporation\" className=\"form-control\" required />\n                            </div>\n                        </div> */}\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <label style={{ fontWeight: 'bold' }}>Select A Plan</label>\n                                <select name=\"plan\" className=\"form-control\" onChange={onChangePlan} required>\n                                    <option value=\"\">Select a Plan</option>\n                                    <option value=\"90/280000\">3 Months Plan - 2800</option>\n                                    <option value=\"180/455000\">6 Months Plan - 4550</option>\n                                    <option value=\"365/797000\">1 Year Plan  - 7970 </option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"row mt-3\">\n                        <div className=\"col\">\n                            <button\n                                type=\"submit\"\n                                className=\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"\n                                disabled={Btn}\n                                onClick={showStaff}\n\n                            >\n                                {spinner ? <Spinner as=\"span\" animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\" /> : \"Proceed\"}\n                            </button>\n                        </div>\n                    </div>\n\n                </Modal.Body>\n\n            </Modal>\n            <PayStackButton\n                show={payModal}\n                onHide={() => setPayModal(false)}\n                close={close}\n                callback={onSuccess}\n                email={user ? user.email : \"\"}\n                amount={total}\n            />\n\n            <StaffModal\n                show={staffModal}\n                onHide={() => setStaffModal(!staffModal)}\n                amount={amount}\n                closeStaffModal={closeStaffModal}\n            />\n        </>\n    );\n}\nexport default LMSubForm;"]},"metadata":{},"sourceType":"module"}