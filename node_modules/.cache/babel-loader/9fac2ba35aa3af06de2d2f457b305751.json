{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Desktop/esgrown/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,Fragment}from'react';import PayStackButton from'../paystack/paystackpaymentbutton';import{Modal,Spinner}from'react-bootstrap';import axios from'axios';import toast from'../../../util/toast';export default function Form(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modalShow=_useState2[0],setModalShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),modalPayShow=_useState4[0],setModalPayShow=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),LOE=_useState6[0],setLOE=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),FIS=_useState8[0],setFIS=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),TIC=_useState10[0],setTIC=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),ticDisable=_useState12[0],setTicDisable=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),useremail=_useState14[0],setUserEmail=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),userId=_useState16[0],setUserId=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),subStatus=_useState18[0],setSubStatus=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),subPlan=_useState20[0],setSubPlan=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),amount=_useState22[0],setAmount=_useState22[1];var _useState23=useState(2),_useState24=_slicedToArray(_useState23,2),button=_useState24[0],setButton=_useState24[1];//SPINNER STATE\nvar _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),spinner=_useState26[0],setSpinner=_useState26[1];//GET LOGGEDIN USER CREDENTIALS FOR PMT\nuseEffect(function(){var userData=JSON.parse(sessionStorage.getItem('key'));var userEmail=userData.email;var userId=userData.id;setUserEmail(userEmail);setUserId(userId);if(userData.sub_status_eas==='active'){setSubStatus(userData.sub_status_eas);setButton(1);}else{setButton(2);}},[]);var onChangeLOE=function onChangeLOE(e){setLOE(e.target.value);};var onChangeFIS=function onChangeFIS(e){setFIS(e.target.value);};var onRefferalChange=function onRefferalChange(e){if(e.target.value==\"yes\"){setTicDisable(false);}else if(e.target.value==\"no\"){setTicDisable(true);}};var onChangeTIC=function onChangeTIC(e){setTIC(e.target.value);};var onChangePlan=function onChangePlan(e){var plan=e.target.value.split('/');setAmount(plan[1]);setSubPlan(plan[0]);};var onSubmit=function onSubmit(e){e.preventDefault();var SubObject={user_id:props.user.id,sub_status:\"inactive\",user_email:props.user.email,user_name:props.user.name,user_status:props.user.status,levelofeducation:LOE,field_of_intended_study:FIS,tic:TIC};try{setSpinner(true);axios.post('http://localhost:5000/subscriptioneas/add',SubObject).then(function(res){setSpinner(false);setModalShow(false);setModalPayShow(true);}).catch(function(err){console.log('Err: '+err);setSpinner(false);setModalShow(false);});}catch(error){console.log(error);}};//Paystack Functions\nvar onSuccess=function onSuccess(res){console.log(res);setModalPayShow(false);//make a call to https://api.paystack.co/subscription and get all subscription \n//and filter for email of current subscription and extract subscription code.\n//update individual doc with the gotten data.\naxios.get(\"https://api.paystack.co/subscription\",{headers:{\"Authorization\":\"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\"}}).then(function(res){var client=res.data.data.filter(function(st){return st.customer.email===useremail;});var data={ref:res.reference,sub_status:client[0].status,sub_code:client[0].subscription_code};//update eas substatus\naxios.post(\"http://localhost:5000/subscriptioneas/update/easref/\".concat(userId),data).then(function(res){return console.log(res.data);}).catch(function(err){return console.log(err);});//update user details\naxios.post(\"http://localhost:5000/individuals/update/substatus/\".concat(userId),{sub_status_eas:client[0].status}).then(function(res){var globalUser=JSON.parse(sessionStorage.getItem('key'));globalUser.sub_status_eas=client[0].status;sessionStorage.setItem('key',JSON.stringify(globalUser));setButton(1);}).catch(function(err){return console.log(err);});}).catch(function(err){return console.log(err);});};var close=function close(){console.log(\"Payment closed\");setModalPayShow(false);};return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"ml-auto d-flex align-items-center\"},React.createElement(React.Fragment,null,button===1?React.createElement(\"button\",{className:\"btn btn-info btn-sm\",disabled:true,style:{color:'white',background:'#97ba0d',border:'#97ba0d'}},\"Subscribed\"):button===2?React.createElement(\"button\",{className:\"btn btn-info btn-sm\",onClick:function onClick(){return setModalShow(true);}},\"Subscribe\"):React.createElement(\"button\",{className:\"btn btn-info btn-sm\",onClick:function onClick(){return setModalShow(true);}},\"Subscribe\"))),React.createElement(Modal,{show:modalShow,onHide:function onHide(){return setModalShow(false);},\"aria-labelledby\":\"example-custom-modal-styling-title\",centered:true},React.createElement(Modal.Body,null,React.createElement(\"form\",{className:\"container py-4\",onSubmit:onSubmit},React.createElement(\"div\",{className:\"row\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"h6\",null,\"Subscription Details\"))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",required:true,onChange:onChangeLOE},React.createElement(\"option\",null,\"Level of Education\"),React.createElement(\"option\",{value:\"degree\"},\"Degree\"),React.createElement(\"option\",{value:\"masters\"},\"Masters\"),React.createElement(\"option\",{value:\"phd\"},\"Ph.D\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"input\",{label:\"\",type:\"text\",value:FIS,onChange:onChangeFIS,placeholder:\"Field of Intended Study\",required:true,className:\"form-control\"}))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",required:true,onChange:onChangePlan},React.createElement(\"option\",null,\"Select Subscription Plan\"),React.createElement(\"option\",{value:\"PLN_euav5svesnpj2ct/1600000\"},\"Annual(One Year) @ N16,0000\"),React.createElement(\"option\",{value:\"PLN_nl0qpw3j7hsi626/900000\"},\"Biannual(6 Months) @ N9,000\"),React.createElement(\"option\",{value:\"PLN_8cowxwb52yeq6th/500000\"},\"Quarterly(3 Months) @ N5,000\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",onChange:onRefferalChange},React.createElement(\"option\",null,\"Where you refered by a Teacher?\"),React.createElement(\"option\",{value:\"yes\"},\"Yes\"),React.createElement(\"option\",{value:\"no\"},\"No\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"input\",{label:\"\",type:\"text\",disabled:ticDisable,value:TIC,onChange:onChangeTIC,placeholder:ticDisable?\"No Worries, TIC is Optional\":\"Please enter Teacher's Identification Code\",className:\"form-control\"}))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"button\",{type:\"submit\",className:\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\",disabled:spinner},\"Proceed \",spinner?React.createElement(Spinner,{as:\"span\",animation:\"grow\",size:\"sm\",role:\"status\",\"aria-hidden\":\"true\"}):\"\")))))),React.createElement(PayStackButton,{show:modalPayShow,onHide:function onHide(){return setModalPayShow(false);},close:close,callback:onSuccess,email:useremail,amount:amount,plan:subPlan}));}","map":{"version":3,"sources":["/Users/mac/Desktop/esgrown/src/components/ind_dashboard_components/subscription-forms/eas-form.js"],"names":["React","useState","useEffect","Fragment","PayStackButton","Modal","Spinner","axios","toast","Form","props","modalShow","setModalShow","modalPayShow","setModalPayShow","LOE","setLOE","FIS","setFIS","TIC","setTIC","ticDisable","setTicDisable","useremail","setUserEmail","userId","setUserId","subStatus","setSubStatus","subPlan","setSubPlan","amount","setAmount","button","setButton","spinner","setSpinner","userData","JSON","parse","sessionStorage","getItem","userEmail","email","id","sub_status_eas","onChangeLOE","e","target","value","onChangeFIS","onRefferalChange","onChangeTIC","onChangePlan","plan","split","onSubmit","preventDefault","SubObject","user_id","user","sub_status","user_email","user_name","name","user_status","status","levelofeducation","field_of_intended_study","tic","post","then","res","catch","err","console","log","error","onSuccess","get","headers","client","data","filter","st","customer","ref","reference","sub_code","subscription_code","globalUser","setItem","stringify","close","color","background","border"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Fragment } from 'react';\nimport PayStackButton from '../paystack/paystackpaymentbutton';\nimport { Modal, Spinner } from 'react-bootstrap';\nimport axios from 'axios';\nimport toast from '../../../util/toast';\n\n\n\n\nexport default function Form(props) {\n\n    const [modalShow, setModalShow] = useState(false);\n    const [modalPayShow, setModalPayShow] = useState(false);\n    const [LOE, setLOE] = useState(\"\");\n    const [FIS, setFIS] = useState(\"\");\n    const [TIC, setTIC] = useState(\"\");\n    const [ticDisable, setTicDisable] = useState(true);\n    const [useremail, setUserEmail] = useState(\"\");\n    const [userId, setUserId] = useState(\"\");\n    const [subStatus, setSubStatus] = useState(false);\n\n\n    const [subPlan, setSubPlan] = useState(\"\");\n    const [amount, setAmount] = useState(\"\");\n    const [button, setButton] = useState(2)\n\n    //SPINNER STATE\n    const [spinner, setSpinner] = useState(false);\n\n    //GET LOGGEDIN USER CREDENTIALS FOR PMT\n    useEffect(() => {\n        const userData = JSON.parse(sessionStorage.getItem('key'));\n        const userEmail = userData.email;\n        const userId = userData.id;\n        setUserEmail(userEmail);\n        setUserId(userId);\n\n\n        if (userData.sub_status_eas === 'active') {\n\n            setSubStatus(userData.sub_status_eas);\n            setButton(1);\n\n        }else{\n            setButton(2);\n        }\n\n    }, [])\n\n\n    const onChangeLOE = (e) => {\n        setLOE(e.target.value);\n\n    }\n\n    const onChangeFIS = (e) => {\n        setFIS(e.target.value);\n    }\n\n    const onRefferalChange = (e) => {\n        if (e.target.value == \"yes\") {\n            setTicDisable(false);\n        } else if (e.target.value == \"no\") {\n            setTicDisable(true);\n        }\n\n    }\n\n    const onChangeTIC = (e) => {\n        setTIC(e.target.value);\n    }\n\n    const onChangePlan = (e) => {\n        const plan = e.target.value.split('/');\n        setAmount(plan[1]);\n        setSubPlan(plan[0]);\n    }\n\n\n    const onSubmit = (e) => {\n        e.preventDefault();\n\n        const SubObject = {\n            user_id: props.user.id,\n            sub_status: \"inactive\",\n            user_email: props.user.email,\n            user_name: props.user.name,\n            user_status: props.user.status,\n            levelofeducation: LOE,\n            field_of_intended_study: FIS,\n            tic: TIC\n        }\n        try {\n            setSpinner(true);\n            axios.post('http://localhost:5000/subscriptioneas/add', SubObject)\n                .then((res) => {\n                    setSpinner(false);\n                    setModalShow(false);\n                    setModalPayShow(true);\n                })\n                .catch((err) => {\n                    console.log('Err: ' + err);\n                    setSpinner(false);\n                    setModalShow(false);\n                });\n\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n\n    //Paystack Functions\n    const onSuccess = (res) => {\n        console.log(res);\n        setModalPayShow(false);\n\n        //make a call to https://api.paystack.co/subscription and get all subscription \n        //and filter for email of current subscription and extract subscription code.\n        //update individual doc with the gotten data.\n\n        axios.get(`https://api.paystack.co/subscription`, { headers: { \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\" } })\n            .then(res => {\n                const client = res.data.data.filter(st => {\n                    return st.customer.email === useremail\n                })\n\n                const data = {\n                    ref: res.reference,\n                    sub_status: client[0].status,\n                    sub_code: client[0].subscription_code\n                }\n\n                //update eas substatus\n                axios.post(`http://localhost:5000/subscriptioneas/update/easref/${userId}`, data)\n                    .then(res => console.log(res.data))\n                    .catch(err => console.log(err))\n\n\n                //update user details\n                axios.post(`http://localhost:5000/individuals/update/substatus/${userId}`, { sub_status_eas: client[0].status})\n                    .then(res => {\n                        const globalUser = JSON.parse(sessionStorage.getItem('key'));\n\n                        globalUser.sub_status_eas = client[0].status;\n\n                        sessionStorage.setItem('key', JSON.stringify(globalUser));\n                        setButton(1)\n\n                    }).catch(err => console.log(err))\n\n            }).catch(err => console.log(err));\n\n\n    }\n\n    const close = () => {\n        console.log(\"Payment closed\");\n        setModalPayShow(false)\n    }\n\n\n    return (\n        <React.Fragment>\n            <div className=\"ml-auto d-flex align-items-center\">\n                <React.Fragment>\n                    {(button === 1) ? <button className=\"btn btn-info btn-sm\" disabled style={{ color: 'white', background: '#97ba0d', border: '#97ba0d' }}>Subscribed</button> : (button === 2) ? <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button> : <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button>}\n                </React.Fragment>\n\n            </div>\n            <Modal\n                show={modalShow}\n                onHide={() => setModalShow(false)}\n                aria-labelledby=\"example-custom-modal-styling-title\"\n                centered\n            >\n                <Modal.Body>\n\n                    <form className=\"container py-4\" onSubmit={onSubmit}>\n                        <div className=\"row\">\n                            <div className=\"col\">\n                                <h6>Subscription Details</h6>\n                            </div>\n                        </div>\n                        {/* Level of Education */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangeLOE}>\n                                    <option>Level of Education</option>\n                                    <option value=\"degree\">Degree</option>\n                                    <option value=\"masters\">Masters</option>\n                                    <option value=\"phd\">Ph.D</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Intended Study field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    value={FIS}\n                                    onChange={onChangeFIS}\n                                    placeholder=\"Field of Intended Study\"\n                                    required\n                                    className=\"form-control\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangePlan}>\n                                    <option>Select Subscription Plan</option>\n                                    <option value=\"PLN_euav5svesnpj2ct/1600000\">Annual(One Year) @ N16,0000</option>\n                                    <option value=\"PLN_nl0qpw3j7hsi626/900000\">Biannual(6 Months) @ N9,000</option>\n                                    <option value=\"PLN_8cowxwb52yeq6th/500000\">Quarterly(3 Months) @ N5,000</option>\n                                </select>\n                            </div>\n                        </div>\n\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" onChange={onRefferalChange}>\n                                    <option>Where you refered by a Teacher?</option>\n                                    <option value=\"yes\">Yes</option>\n                                    <option value=\"no\">No</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Tic field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    disabled={ticDisable}\n                                    value={TIC}\n                                    onChange={onChangeTIC}\n                                    placeholder={ticDisable ? \"No Worries, TIC is Optional\" : \"Please enter Teacher's Identification Code\"}\n                                    className=\"form-control\"\n\n                                />\n                            </div>\n                        </div>\n\n                        {/* submit button */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <button\n                                    type=\"submit\"\n                                    className=\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"\n                                    disabled={spinner}\n                                >\n                                    Proceed {spinner ?\n                                        <Spinner as=\"span\" animation=\"grow\" size=\"sm\" role=\"status\" aria-hidden=\"true\" /> : \"\"}\n                                </button>\n                            </div>\n                        </div>\n                    </form>\n\n                </Modal.Body>\n            </Modal>\n            <PayStackButton\n                show={modalPayShow}\n                onHide={() => setModalPayShow(false)}\n                close={close}\n                callback={onSuccess}\n                email={useremail}\n                amount={amount}\n                plan={subPlan}\n            />\n        </React.Fragment>\n    );\n}"]},"metadata":{},"sourceType":"module"}