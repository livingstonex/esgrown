{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Desktop/esgrown/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,Fragment}from'react';import axios from'axios';import PayStackButton from'../paystack/paystackpaymentbutton';import{Modal}from'react-bootstrap/';export default function Form(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modalShow=_useState2[0],setModalShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),spinner=_useState4[0],setSpinner=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),LOE=_useState6[0],setLOE=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),NIEL=_useState8[0],setNIEL=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),FIS=_useState10[0],setFIS=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),TIC=_useState12[0],setTIC=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),ticDisable=_useState14[0],setTicDisable=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),useremail=_useState16[0],setUserEmail=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),userId=_useState18[0],setUserId=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),subStatus=_useState20[0],setSubStatus=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),modalPayShow=_useState22[0],setModalPayShow=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),subPlan=_useState24[0],setSubPlan=_useState24[1];var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),amount=_useState26[0],setAmount=_useState26[1];var _useState27=useState(0),_useState28=_slicedToArray(_useState27,2),button=_useState28[0],setButton=_useState28[1];//GET LOGGEDIN USER CREDENTIALS FOR PMT\nuseEffect(function(){var userData=JSON.parse(sessionStorage.getItem('key'));var userEmail=userData.email;var userId=userData.id;setUserEmail(userEmail);setUserId(userId);//get sub status for user\n// axios.get(`http://localhost:5000/subscriptionefa/${userData.id}`)\n//     .then(res => {\n//         if (res.data[0].ref != null) {\n//             // setSubStatus(res.data[0].sub_status);\n//             setButton(1);\n//         }else{\n//             setButton(2);\n//         }\n//     })\n//     .catch(err => console.log(err))\nif(userData.sub_status_efa==='active'){setSubStatus(userData.sub_status_efa);setButton(1);}else{setButton(2);}},[]);var onChangeLOE=function onChangeLOE(e){setLOE(e.target.value);};var onChangeNIEL=function onChangeNIEL(e){setNIEL(e.target.value);};var onRefferalChange=function onRefferalChange(e){if(e.target.value==\"yes\"){setTicDisable(false);}else if(e.target.value==\"no\"){setTicDisable(true);setTIC(\"\");}};var onChangeFIS=function onChangeFIS(e){setFIS(e.target.value);};var onChangeTIC=function onChangeTIC(e){setTIC(e.target.value);};var onChangePlan=function onChangePlan(e){var plan=e.target.value.split('/');setSubPlan(plan[0]);setAmount(plan[1]);};var onSubmit=function onSubmit(e){e.preventDefault();var SubObject={user_id:props.user.id,sub_status:false,user_email:props.user.email,user_name:props.user.name,user_status:props.user.status,levelofeducation:LOE,next_intended_education_level:NIEL,field_of_intended_study:FIS,tic:TIC};//console.log(SubObject);\ntry{setSpinner(true);axios.post('http://localhost:5000/subscriptionefa/add',SubObject).then(function(res){console.log(res.data);setSpinner(false);setModalShow(false);setModalPayShow(true);}).catch(function(err){console.log('Err: '+err);setSpinner(false);setModalShow(false);});}catch(error){console.log(error);}};//Paystack Functions\nvar onSuccess=function onSuccess(res){console.log(res);setModalPayShow(false);//make a call to https://api.paystack.co/subscription and get all subscription \n//and filter for email of current subscription and extract subscription code.\n//update individual doc with the gotten data.\naxios.get(\"https://api.paystack.co/subscription\",{headers:{\"Authorization\":\"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\"}}).then(function(res){var client=res.data.data.filter(function(st){return st.customer.email===useremail;});var data={ref:res.reference,sub_status:client[0].status,sub_code:client[0].subscription_code};//update eas substatus\naxios.post(\"http://localhost:5000/subscriptionefa/update/efaref/\".concat(userId),data).then(function(res){return console.log(res);}).catch(function(err){return console.log(err);});//update user details\naxios.post(\"http://localhost:5000/individuals/update/substatus/\".concat(userId),{sub_status_efa:client[0].status}).then(function(res){var globalUser=JSON.parse(sessionStorage.getItem('key'));globalUser.sub_status_efa=client[0].status;sessionStorage.setItem('key',JSON.stringify(globalUser));setButton(1);}).catch(function(err){return console.log(err);});}).catch(function(err){return console.log(err);});};var close=function close(){console.log(\"Payment closed\");setModalPayShow(false);};return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"ml-auto d-flex align-items-center\"},React.createElement(React.Fragment,null,button===1?React.createElement(\"button\",{className:\"btn btn-info btn-sm\",disabled:true,style:{color:'white',background:'#97ba0d',border:'#97ba0d'}},\"Subscribed\"):button===2?React.createElement(\"button\",{className:\"btn btn-info btn-sm\",onClick:function onClick(){return setModalShow(true);}},\"Subscribe\"):React.createElement(\"button\",{className:\"btn btn-info btn-sm\",onClick:function onClick(){return setModalShow(true);}},\"Subscribe\"))),React.createElement(Modal,{show:modalShow,onHide:function onHide(){return setModalShow(false);},\"aria-labelledby\":\"example-custom-modal-styling-title\",centered:true},React.createElement(Modal.Body,null,React.createElement(\"form\",{className:\"container py-4\",onSubmit:onSubmit},React.createElement(\"div\",{className:\"row\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"h6\",null,\"Subscription Details\"))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",required:true,onChange:onChangeLOE},React.createElement(\"option\",null,\"Level of Education\"),React.createElement(\"option\",{value:\"degree\"},\"Degree\"),React.createElement(\"option\",{value:\"masters\"},\"Masters\"),React.createElement(\"option\",{value:\"phd\"},\"Ph.D\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",required:true,onChange:onChangeNIEL},React.createElement(\"option\",null,\"Next Intended Education Level\"),React.createElement(\"option\",{value:\"secondary school\"},\"Secondary School\"),React.createElement(\"option\",{value:\"undergraduate\"},\"Undergraduate\"),React.createElement(\"option\",{value:\"masters\"},\"Masters\"),React.createElement(\"option\",{value:\"phd\"},\"Ph.D\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"input\",{label:\"\",type:\"text\",value:FIS,onChange:onChangeFIS,placeholder:\"Field of Intended Study\",required:true,className:\"form-control\"}))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",required:true,onChange:onChangePlan},React.createElement(\"option\",null,\"Select Subscription Plan\"),React.createElement(\"option\",{value:\"PLN_gkcu1vni2vwc56h/524000\"},\"Annual(One Year)\"),React.createElement(\"option\",{value:\"PLN_7b0a3p1r8im1xb8/279000\"},\"Biannual(6 Months)\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"select\",{className:\"form-control\",onChange:onRefferalChange},React.createElement(\"option\",null,\"Where you refered by a Teacher?\"),React.createElement(\"option\",{value:\"yes\"},\"Yes\"),React.createElement(\"option\",{value:\"no\"},\"No\")))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"input\",{label:\"\",type:\"text\",disabled:ticDisable,value:TIC,onChange:onChangeTIC,placeholder:\"TIC\",className:\"form-control\"}))),React.createElement(\"div\",{className:\"row mt-3\"},React.createElement(\"div\",{className:\"col\"},React.createElement(\"button\",{type:\"submit\",disabled:spinner,className:\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"// disabled={null}\n},\"Proceed\")))))),React.createElement(PayStackButton,{show:modalPayShow,onHide:function onHide(){return setModalPayShow(false);},close:close,callback:onSuccess,email:useremail,amount:amount,plan:subPlan}));}","map":{"version":3,"sources":["/Users/mac/Desktop/esgrown/src/components/ind_dashboard_components/subscription-forms/efa-form.js"],"names":["React","useState","useEffect","Fragment","axios","PayStackButton","Modal","Form","props","modalShow","setModalShow","spinner","setSpinner","LOE","setLOE","NIEL","setNIEL","FIS","setFIS","TIC","setTIC","ticDisable","setTicDisable","useremail","setUserEmail","userId","setUserId","subStatus","setSubStatus","modalPayShow","setModalPayShow","subPlan","setSubPlan","amount","setAmount","button","setButton","userData","JSON","parse","sessionStorage","getItem","userEmail","email","id","sub_status_efa","onChangeLOE","e","target","value","onChangeNIEL","onRefferalChange","onChangeFIS","onChangeTIC","onChangePlan","plan","split","onSubmit","preventDefault","SubObject","user_id","user","sub_status","user_email","user_name","name","user_status","status","levelofeducation","next_intended_education_level","field_of_intended_study","tic","post","then","res","console","log","data","catch","err","error","onSuccess","get","headers","client","filter","st","customer","ref","reference","sub_code","subscription_code","globalUser","setItem","stringify","close","color","background","border"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Fragment } from 'react';\nimport axios from 'axios';\nimport PayStackButton from '../paystack/paystackpaymentbutton';\nimport { Modal } from 'react-bootstrap/';\n\n\nexport default function Form(props) {\n\n    const [modalShow, setModalShow] = useState(false);\n    const [spinner, setSpinner] = useState(false);\n    const [LOE, setLOE] = useState(\"\");\n    const [NIEL, setNIEL] = useState(\"\");\n    const [FIS, setFIS] = useState(\"\");\n    const [TIC, setTIC] = useState(\"\");\n    const [ticDisable, setTicDisable] = useState(true);\n\n    const [useremail, setUserEmail] = useState(\"\");\n    const [userId, setUserId] = useState(\"\");\n    const [subStatus, setSubStatus] = useState(false);\n    const [modalPayShow, setModalPayShow] = useState(false);\n\n    const [subPlan, setSubPlan] = useState(\"\");\n    const [amount, setAmount] = useState(\"\")\n    const [button, setButton] = useState(0)\n\n\n\n\n\n    //GET LOGGEDIN USER CREDENTIALS FOR PMT\n    useEffect(() => {\n        const userData = JSON.parse(sessionStorage.getItem('key'));\n        const userEmail = userData.email;\n        const userId = userData.id;\n        setUserEmail(userEmail);\n        setUserId(userId);\n\n        //get sub status for user\n        // axios.get(`http://localhost:5000/subscriptionefa/${userData.id}`)\n        //     .then(res => {\n        //         if (res.data[0].ref != null) {\n        //             // setSubStatus(res.data[0].sub_status);\n        //             setButton(1);\n        //         }else{\n        //             setButton(2);\n        //         }\n\n        //     })\n        //     .catch(err => console.log(err))\n\n        if (userData.sub_status_efa === 'active') {\n\n            setSubStatus(userData.sub_status_efa);\n            setButton(1);\n\n        } else {\n            setButton(2);\n        }\n\n    }, [])\n\n\n\n    const onChangeLOE = (e) => {\n        setLOE(e.target.value);\n    }\n\n    const onChangeNIEL = (e) => {\n        setNIEL(e.target.value);\n    }\n\n    const onRefferalChange = (e) => {\n        if (e.target.value == \"yes\") {\n            setTicDisable(false);\n        } else if (e.target.value == \"no\") {\n            setTicDisable(true);\n            setTIC(\"\");\n        }\n    }\n\n    const onChangeFIS = (e) => {\n        setFIS(e.target.value);\n    }\n\n    const onChangeTIC = (e) => {\n        setTIC(e.target.value);\n    }\n\n    const onChangePlan = (e) => {\n        const plan = e.target.value.split('/');\n        setSubPlan(plan[0]);\n        setAmount(plan[1]);\n    }\n\n    const onSubmit = (e) => {\n        e.preventDefault();\n\n        const SubObject = {\n            user_id: props.user.id,\n            sub_status: false,\n            user_email: props.user.email,\n            user_name: props.user.name,\n            user_status: props.user.status,\n            levelofeducation: LOE,\n            next_intended_education_level: NIEL,\n            field_of_intended_study: FIS,\n            tic: TIC\n        }\n        //console.log(SubObject);\n        try {\n            setSpinner(true);\n            axios.post('http://localhost:5000/subscriptionefa/add', SubObject)\n                .then((res) => {\n                    console.log(res.data);\n                    setSpinner(false);\n                    setModalShow(false);\n                    setModalPayShow(true);\n\n                })\n                .catch((err) => {\n                    console.log('Err: ' + err);\n                    setSpinner(false);\n                    setModalShow(false);\n                });\n\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n    //Paystack Functions\n    const onSuccess = (res) => {\n        console.log(res);\n        setModalPayShow(false);\n\n        //make a call to https://api.paystack.co/subscription and get all subscription \n        //and filter for email of current subscription and extract subscription code.\n        //update individual doc with the gotten data.\n\n        axios.get(`https://api.paystack.co/subscription`, { headers: { \"Authorization\": \"Bearer sk_test_19f4c12e4e018a9f742e1723d42c9c8e509800b4\" } })\n            .then(res => {\n                const client = res.data.data.filter(st => {\n                    return st.customer.email === useremail\n                })\n\n                const data = {\n                    ref: res.reference,\n                    sub_status: client[0].status,\n                    sub_code: client[0].subscription_code\n                }\n\n                //update eas substatus\n                axios.post(`http://localhost:5000/subscriptionefa/update/efaref/${userId}`, data)\n                    .then(res => console.log(res))\n                    .catch(err => console.log(err))\n\n\n                //update user details\n                axios.post(`http://localhost:5000/individuals/update/substatus/${userId}`, { sub_status_efa: client[0].status,})\n                    .then(res => {\n                        const globalUser = JSON.parse(sessionStorage.getItem('key'));\n\n                        globalUser.sub_status_efa = client[0].status;\n\n                        sessionStorage.setItem('key', JSON.stringify(globalUser));\n                        setButton(1)\n\n                    }).catch(err => console.log(err))\n\n            }).catch(err => console.log(err));\n\n\n    }\n\n    const close = () => {\n        console.log(\"Payment closed\");\n        setModalPayShow(false)\n    }\n\n    return (\n        <React.Fragment>\n            <div className=\"ml-auto d-flex align-items-center\">\n                <React.Fragment>\n                    {(button === 1) ? <button className=\"btn btn-info btn-sm\" disabled style={{ color: 'white', background: '#97ba0d', border: '#97ba0d' }}>Subscribed</button> : (button === 2) ? <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button> : <button className=\"btn btn-info btn-sm\" onClick={() => setModalShow(true)}>Subscribe</button>}\n\n                </React.Fragment>\n\n            </div>\n            <Modal\n                show={modalShow}\n                onHide={() => setModalShow(false)}\n                aria-labelledby=\"example-custom-modal-styling-title\"\n                centered\n            >\n                <Modal.Body>\n                    <form className=\"container py-4\" onSubmit={onSubmit}>\n                        <div className=\"row\">\n                            <div className=\"col\">\n                                <h6>Subscription Details</h6>\n                            </div>\n                        </div>\n                        {/* Level of Education */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangeLOE}>\n                                    <option>Level of Education</option>\n                                    <option value=\"degree\">Degree</option>\n                                    <option value=\"masters\">Masters</option>\n                                    <option value=\"phd\">Ph.D</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Next intended education level field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangeNIEL}>\n                                    <option>Next Intended Education Level</option>\n                                    <option value=\"secondary school\">Secondary School</option>\n                                    <option value=\"undergraduate\">Undergraduate</option>\n                                    <option value=\"masters\">Masters</option>\n                                    <option value=\"phd\">Ph.D</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Field of Intended Study */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    value={FIS}\n                                    onChange={onChangeFIS}\n                                    placeholder=\"Field of Intended Study\"\n                                    required\n                                    className=\"form-control\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" required onChange={onChangePlan}>\n                                    <option>Select Subscription Plan</option>\n                                    <option value=\"PLN_gkcu1vni2vwc56h/524000\">Annual(One Year)</option>\n                                    <option value=\"PLN_7b0a3p1r8im1xb8/279000\">Biannual(6 Months)</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <select className=\"form-control\" onChange={onRefferalChange}>\n                                    <option>Where you refered by a Teacher?</option>\n                                    <option value=\"yes\">Yes</option>\n                                    <option value=\"no\">No</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Tic field */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n\n                                <input\n                                    label=\"\"\n                                    type=\"text\"\n                                    disabled={ticDisable}\n                                    value={TIC}\n                                    onChange={onChangeTIC}\n                                    placeholder=\"TIC\"\n                                    className=\"form-control\"\n\n                                />\n                            </div>\n                        </div>\n\n                        {/* submit button */}\n                        <div className=\"row mt-3\">\n                            <div className=\"col\">\n                                <button\n                                    type=\"submit\"\n                                    disabled={spinner}\n                                    className=\"btn font-weight-light btn-primary mt-3 py-2 w-100 border-0\"\n                                // disabled={null}\n                                >Proceed</button>\n                            </div>\n                        </div>\n                    </form>\n                </Modal.Body>\n            </Modal>\n            <PayStackButton\n                show={modalPayShow}\n                onHide={() => setModalPayShow(false)}\n                close={close}\n                callback={onSuccess}\n                email={useremail}\n                amount={amount}\n                plan={subPlan}\n            />\n\n        </React.Fragment>\n    );\n}"]},"metadata":{},"sourceType":"module"}